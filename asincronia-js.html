<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asincronia en JS</title>
  </head>
  <body>
    <h1>Asincronia en JS</h1>
    <script>
      console.log("Sin set time");
      /*setTimeout(() => {
          console.log(
            "Ejecutando un set time out, este se ejecuta una vez y despues del tiempo definido"
          );
        }, 5000);
        setInterval(() => {
          console.log(
            "Ejecutando un set interval, este se ejecuta indefinidamente, cada cierto periodo de tiempo"
          );
        }, 4000);
        let setTimeInterval = setInterval(() => {
          console.log(new Date().toLocaleTimeString());
        }, 10000);
        clearInterval(setTimeInterval);
        console.log("Despues del interval");*/
      console.clear();
      /*Antes de explicar como funciona el metodo de JavaScript es importante entender algunos conceptos

        Prosesamiento single thread y multi thread
        Operaciones de CPU y operaciones de I/O
        Operaciones concurrentes y paralelas
        Operaciones bloqueantes y no bloqueantes
        Operaciones sincronas y asincronas

        */
      //Codigo sincrono bloqueante

      () => {
        console.log("codigo sincrono");
        console.log("inicio");

        function dos() {
          console.log("dos");
        }
        function uno() {
          console.log("uno");
          dos();
          console.log("tres");
        }
        uno();
        console.log("fin");
      };
      //Codigo asincrono no bloqueante
      () => {
        console.log("Codigo asincrono no bloqueante");
        console.log("inicio");

        function dos() {
          setTimeout(() => {
            console.log("dos");
          }, 1000);
        }
        function uno() {
          setTimeout(() => {
            console.log("uno");
            dos();
            console.log("tres");
          }, 1000);
        }
        uno();
        console.log("fin");
      };
      console.clear();
      /*Las callback nos combienen cuando tenemos un proseso asincrono*/
      /*function cuadradoCallback(value, callback) {
        setTimeout(() => {
          callback(value, value * value);
        }, 0 | (Math.random() * 1000));
      }
      cuadradoCallback(0, (value, result) => {
        console.log("inicia callback");
        console.log(`${value}, ${result} `);
        cuadradoCallback(1, (value, result) => {
          console.log(`${value}, ${result} `);
          cuadradoCallback(2, (value, result) => {
            console.log(`${value}, ${result} `);
            cuadradoCallback(3, (value, result) => {
              console.log(`${value}, ${result} `);
              cuadradoCallback(4, (value, result) => {
                console.log(`${value}, ${result} `);
                cuadradoCallback(5, (value, result) => {
                  console.log(`${value}, ${result} `);
                  console.log("Aqui termina la Callback HELL!!!!");
                });
              });
            });
          });
        });
      });*/
      console.clear();
      /*Las promesas nos combienen cuando tenemos mas de un proseso asincrono*/
      /*function cuadradoPromise(value) {
        if (typeof value !== "number")
          return Promise.reject(
            `Error el valor ingresado: ${value} NO es un numero`
          );
        return new Promise((resolve, reject) => {
          setTimeout(
            () =>
              resolve({
                value,
                result: value * value,
              }),
            1000 | (Math.random() * 100)
          );
        });
      }
      cuadradoPromise(0)
        .then((obj) => {
          console.log("inicia Promise");
          console.log(`${obj.value}, ${obj.result}`);
          return cuadradoPromise(1);
        })
        .then((obj) => {
          console.log(`${obj.value}, ${obj.result}`);
          return cuadradoPromise(2);
        })
        .then((obj) => {
          console.log(`${obj.value}, ${obj.result}`);
          return cuadradoPromise("3");
        })
        .then((obj) => {
          console.log(`${obj.value}, ${obj.result}`);
          return cuadradoPromise(4);
        })
        .then((obj) => {
          console.log(`${obj.value}, ${obj.result}`);
          return cuadradoPromise(5);
        })
        .then((obj) => {
          console.log(`${obj.value}, ${obj.result}`);
          return console.log("Fin de la promesa");
        })
        .catch((err) => console.error(err));*/
      console.clear();
      /*******************************Asinc - Await**********************************/
      function cuadradoPromise(value) {
        if (typeof value !== "number")
          return Promise.reject(
            `Error el valor ingresado: ${value} NO es un numero`
          );
        return new Promise((resolve, reject) => {
          setTimeout(
            () =>
              resolve({
                value,
                result: value * value,
              }),
            1000 | (Math.random() * 100)
          );
        });
      }

      async function funcionAsincronaDeclarada() {
        try {
          console.log("Async funcion inicia");
          let obj = await cuadradoPromise(0);
          console.log(`Async function ${obj.value}, ${obj.result}`);
          obj = await cuadradoPromise(1);
          console.log(`Async function ${obj.value}, ${obj.result}`);
          obj = await cuadradoPromise(2);
          console.log(`Async function ${obj.value}, ${obj.result}`);
          obj = await cuadradoPromise(3);
          console.log(`Async function ${obj.value}, ${obj.result}`);
          obj = await cuadradoPromise(4);
          console.log(`Async function ${obj.value}, ${obj.result}`);
          obj = await cuadradoPromise(5);
          console.log(`Async function ${obj.value}, ${obj.result}`);
        } catch (err) {}
      }
      funcionAsincronaDeclarada();

      const funcionAsincronaExpresada = async () => {
        try {
          console.log("Async funcion inicia");
          let obj = await cuadradoPromise(6);
          console.log(`Async function ${obj.value}, ${obj.result}`);
          obj = await cuadradoPromise(7);
          console.log(`Async function ${obj.value}, ${obj.result}`);
          obj = await cuadradoPromise(8);
          console.log(`Async function ${obj.value}, ${obj.result}`);
          obj = await cuadradoPromise(9);
          console.log(`Async function ${obj.value}, ${obj.result}`);
          obj = await cuadradoPromise(10);
          console.log(`Async function ${obj.value}, ${obj.result}`);
        } catch (err) {}
      };

      funcionAsincronaExpresada();
    </script>
  </body>
</html>
